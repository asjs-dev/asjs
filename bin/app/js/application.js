;function defineProperty(target,propertyName,params){params.enumerable=true;params.configurable=true;Object.defineProperty(target,propertyName,params);};function extendClass(parent){return $.extend(true,{},parent);};function extendProperty(target,parent,propertyName){Object.defineProperty(target,propertyName,Object.getOwnPropertyDescriptor(parent,propertyName));};function extendFunction(target,parent,propertyName){target[propertyName]=parent[propertyName];};var sourcePath="";function sourcePath(value){if(sourcePath!="")return;sourcePath=value;};var includedScript={};function includeOnce(filename){if(includedScript[filename])return;includedScript[filename]=1;$.ajaxSetup({async:false});$.getScript(sourcePath+filename);$.ajaxSetup({async:true});};var stage;var ASJS={};ASJS.inited;ASJS.startASJS=function(baseClass){if(ASJS.inited)return;ASJS.inited=true;var dfd=new $.Deferred();$(document).ready(function(){stage=new ASJS.Stage().instance;stage.init();dfd.resolve(new baseClass());});return dfd.promise();};ASJS.Event=function(type){var that=$.Event(type);return that;};ASJS.Event.CHANGE="change";ASJS.MouseEvent=function(type){var that=new ASJS.Event(type);return that;};ASJS.MouseEvent.SCROLL="DOMMouseScroll mousewheel scroll";ASJS.MouseEvent.CLICK="click";ASJS.MouseEvent.DOUBLE_CLICK="dblclick";ASJS.MouseEvent.MOUSE_DOWN="mousedown";ASJS.MouseEvent.MOUSE_UP="mouseup";ASJS.MouseEvent.MOUSE_LEAVE="mouseleave";ASJS.MouseEvent.MOUSE_ENTER="mouseenter";ASJS.MouseEvent.MOUSE_MOVE="mousemove";ASJS.MouseEvent.MOUSE_OVER="mouseover";ASJS.MouseEvent.MOUSE_OUT="mouseout";ASJS.MouseEvent.TOUCH_START="touchstart";ASJS.MouseEvent.TOUCH_END="touchend";ASJS.MouseEvent.TOUCH_MOVE="touchmove";ASJS.MouseEvent.TOUCH_CANCEL="touchcancel";ASJS.MouseEvent.CONTEXT_MENU="contextmenu";ASJS.MouseEvent.SELECT_START="onselectstart";ASJS.EventDispatcher=function(domElement){var that={};that.dispatchEvent=function(type,data,bubble){var eventBubble=bubble==undefined?true:bubble;if(eventBubble)that.domObject.trigger(type,data);else that.domObject.triggerHandler(type,data);};that.addEventListener=function(type,callback){if(type==ASJS.MouseEvent.SCROLL&&that.domObject==stage.window.domObject)that.domObject.scroll(callback);else that.domObject.on(type,callback);};that.removeEventListeners=function(){that.domObject.off();};that.removeEventListener=function(type,callback){that.domObject.off(type,null,callback);};that.hasEventListener=function(which,handler){var events=$._data(that.domElement,"events");if(events==undefined)return false;var w=which.indexOf(" ")>-1?which.split(" "):[which];var i=-1;var l=w.length;while(++i<l){var event=events[w[i]];if(event!=undefined){var j=-1;var k=event.length;while(++j<k){if(event[j].handler==handler)return true;}}};return false;};that.domObject=$(domElement||"<div />");return that;};ASJS.PrimitiveDisplayObject=function(domElement){var that=new ASJS.EventDispatcher(domElement);defineProperty(that,"text",{get:function(){return that.domObject.text();},set:function(value){that.domObject.text(value);}});defineProperty(that,"domElement",{get:function(){return that.domObject[0];}});that.getAttr=function(key){return that.domObject.attr(key);};that.setAttr=function(key,value){that.domObject.attr(key,value);};that.removeAttr=function(key){that.domObject.removeAttr(key);};that._sendAddedToStageEvent=function(){};that.domObject=$(domElement||"<div />");return that;};ASJS.Point=function(x,y){var that={};that.x=x||0;that.y=y||0;return that;};ASJS.Mouse=function(){function MouseInstance(){var that={};var EVENT=ASJS.MouseEvent.MOUSE_MOVE+" "+ASJS.MouseEvent.TOUCH_MOVE;var _mousePos=new ASJS.Point();defineProperty(that,"mouseX",{get:function(){return _mousePos.x;}});defineProperty(that,"mouseY",{get:function(){return _mousePos.y;}});that.show=function(){stage.setCSS("cursor","default");};that.hide=function(){stage.setCSS("cursor","none");};that.getRelativePosition=function(value){return value.globalToLocal(_mousePos);};that.init=function(){if(stage&&!stage.window.hasEventListener(EVENT,onMouseMove))stage.window.addEventListener(EVENT,onMouseMove);};that.getTouchPointByEvent=function(event){var touches=event.touches||event.originalEvent.touches;if(touches&&touches.length>0){var touch=touches[0];return new ASJS.Point(touch.pageX,touch.pageY);};return new ASJS.Point(event.pageX,event.pageY);};function onMouseMove(event){_mousePos=that.getTouchPointByEvent(event);};return that;};defineProperty(this,"instance",{get:function(){if(!ASJS.Mouse.$)ASJS.Mouse.$=new MouseInstance();return ASJS.Mouse.$;}});};ASJS.GeomUtils={};ASJS.GeomUtils.THETA=Math.PI/180;ASJS.GeomUtils.pointInOrigo=function(point){return point.x==0&&point.y==0;};ASJS.GeomUtils.twoPointDistance=function(pointA,pointB){return Math.sqrt(Math.pow(pointB.x-pointA.x,2)+Math.pow(pointB.y-pointA.y,2));};ASJS.GeomUtils.pointInRect=function(point,rect){return point.x>=rect.x&&point.x<=rect.x+rect.width&&point.y>=rect.y&&point.y<=rect.y+rect.height;};ASJS.GeomUtils.twoPointEquals=function(pointA,pointB){return pointA.x==pointB.x&&pointA.y==pointB.y;};ASJS.GeomUtils.twoPointAngle=function(pointA,pointB){var v=new ASJS.Point(pointB.x-pointA.x,pointB.y-pointA.y);var angle=Math.acos(v.x/Math.sqrt(Math.pow(v.x,2)+Math.pow(v.y,2)));return angle/ASJS.GeomUtils.THETA;};ASJS.GeomUtils.rectInRect=function(rectA,rectB){return rectA.x>=rectB.x&&rectA.y==rectB.y&&rectA.x+rectA.width<=rectB.x+rectB.width&&rectA.y+rectA.height<=rectB.y+rectB.height;};ASJS.GeomUtils.localToGlobal=function(target,point){if(!point)throw new Error("DisplayObject.localToGlobal: Point is null");var pos=new ASJS.Point(point.x,point.y);var child=target;while(child){pos.x*=child.scaleX;pos.y*=child.scaleY;pos.x+=child.x;pos.y+=child.y;child=child.parent;};return pos;};ASJS.GeomUtils.globalToLocal=function(target,point){if(!point)throw new Error("DisplayObject.globalToLocal: Point is null");var pos=new ASJS.Point(point.x,point.y);var child=target;var children=[child];while(child){child=child.parent;children.unshift(child);};var i=0;var l=children.length;while(++i<l){child=children[i];pos.x-=child.x;pos.y-=child.y;pos.x/=child.scaleX;pos.y/=child.scaleY;};return pos;};ASJS.GeomUtils.hitTest=function(target,point){var rotationDeg=-target.rotation*ASJS.GeomUtils.THETA;var rect=target.bounds;var globalPos=target.localToGlobal(new ASJS.Point(0,0));var diffPoint=new ASJS.Point(point.x-(globalPos.x+rect.width*0.5),point.y-(globalPos.y+rect.height*0.5));var rotatedDiffPoint=new ASJS.Point(diffPoint.x*Math.cos(rotationDeg)-diffPoint.y*Math.sin(rotationDeg),diffPoint.x*Math.sin(rotationDeg)+diffPoint.y*Math.cos(rotationDeg));var recalcPoint=new ASJS.Point(point.x-(diffPoint.x-rotatedDiffPoint.x),point.y-(diffPoint.y-rotatedDiffPoint.y));var localPoint=target.globalToLocal(recalcPoint);return localPoint.x>=0&&localPoint.y>=0&&localPoint.x<=rect.width&&localPoint.y<=rect.height;};ASJS.Rectangle=function(x,y,width,height){var that=new ASJS.Point(x,y);that.width=width||0;that.height=height||0;return that;};ASJS.DisplayObject=function(domElement){var that=new ASJS.PrimitiveDisplayObject(domElement);var _mouse=new ASJS.Mouse().instance;var CREATED="created";var _state=CREATED;var _filters={};var _rotation=0;var _scaleX=1;var _scaleY=1;var _parent=null;var _cssDisplay="block";defineProperty(that,"bounds",{get:function(){return new ASJS.Rectangle(that.calcX,that.calcY,that.calcWidth,that.calcHeight);}});defineProperty(that,"tooltip",{get:function(){return that.setAttr("title");},set:function(value){that.setAttr("title",value);}});defineProperty(that,"filters",{get:function(){return _filters;},set:function(value){_filters=value;var filters="";var i=-1;var l=_filters.length;while(++i<l){var filter=_filters[i];filters+=" "+filter.execute();};that.setCSS("-webkit-filter",filters);that.setCSS("filter",filters);}});defineProperty(that,"id",{get:function(){return that.getAttr("id");},set:function(value){that.setAttr("id",value);}});defineProperty(that,"enabled",{get:function(){return that.getAttr("disabled")!="disabled";},set:function(value){if(value){that.removeAttr("disabled");that.setCSS("pointer-events","auto");}else{that.setAttr("disabled","disabled");that.setCSS("pointer-events","none");}}});defineProperty(that,"display",{get:function(){return _cssDisplay;},set:function(value){_cssDisplay=value;that.setCSS("display",_cssDisplay);}});defineProperty(that,"html",{get:function(){return that.domObject.html();},set:function(value){that.domObject.html(value);}});defineProperty(that,"visible",{get:function(){return that.getCSS("display")!="none";},set:function(value){that.setCSS("display",value?_cssDisplay:"none");}});defineProperty(that,"alpha",{get:function(){return parseFloat(that.getCSS("opacity"))||1;},set:function(value){that.setCSS("opacity",value);}});defineProperty(that,"x",{get:function(){return(parseFloat(that.getCSS("left"))||0)-(that.width-that.width/_scaleX)*0.5;},set:function(value){that.setCSS("left",value+(that.width-that.width/_scaleX)*0.5);}});defineProperty(that,"y",{get:function(){return(parseFloat(that.getCSS("top"))||0)-(that.height-that.height/_scaleY)*0.5;},set:function(value){that.setCSS("top",value+(that.height-that.height/_scaleY)*0.5);}});defineProperty(that,"calcX",{get:function(){return that.x+(parseFloat(that.getCSS("marginLeft"))||0);}});defineProperty(that,"calcY",{get:function(){return that.y+(parseFloat(that.getCSS("marginTop"))||0);}});defineProperty(that,"width",{get:function(){return that.domObject.width()*_scaleX;},set:function(value){that.setCSS("width",typeof value!="number"?value:(parseFloat(value)/_scaleX));}});defineProperty(that,"height",{get:function(){return that.domObject.height()*_scaleY;},set:function(value){that.setCSS("height",typeof value!="number"?value:(parseFloat(value)/_scaleY));}});defineProperty(that,"calcWidth",{get:function(){var paddingLeft=parseFloat(that.getCSS("paddingLeft"))||0;var paddingRight=parseFloat(that.getCSS("paddingRight"))||0;var borderLeft=parseFloat(that.getCSS("borderLeft"))||0;var borderRight=parseFloat(that.getCSS("borderRight"))||0;return that.width+paddingLeft+paddingRight+borderLeft+borderRight;}});defineProperty(that,"calcHeight",{get:function(){var paddingTop=parseFloat(that.getCSS("paddingTop"))||0;var paddingBottom=parseFloat(that.getCSS("paddingBottom"))||0;var borderTop=parseFloat(that.getCSS("borderTop"))||0;var borderBottom=parseFloat(that.getCSS("borderBottom"))||0;return that.height+paddingTop+paddingBottom+borderTop+borderBottom;}});defineProperty(that,"rotation",{get:function(){return _rotation;},set:function(value){_rotation=parseFloat(value);drawTransform();}});defineProperty(that,"scaleX",{get:function(){return _scaleX;},set:function(value){_scaleX=parseFloat(value);var oW=that.width/_scaleX;that.x+=(that.width-oW)*0.5;drawTransform();}});defineProperty(that,"scaleY",{get:function(){return _scaleY;},set:function(value){_scaleY=parseFloat(value);var oH=that.height/_scaleY;that.y+=(that.height-oH)*0.5;drawTransform();}});defineProperty(that,"parent",{get:function(){return _parent;},set:function(value){if(value==null||value.getChildIndex(that)>-1){_parent=value;that._sendAddedToStageEvent();}}});defineProperty(that,"stage",{get:function(){return that.parent?that.parent.stage:null;}});defineProperty(that,"mouse",{get:function(){return _mouse.getRelativePosition(that);}});that.requestFullscreen=function(){if(!ASJS.DisplayObject.FULLSCREEN_ENABLED)return;if(that.domElement.requestFullscreen)that.domElement.requestFullscreen();else if(that.domElement.webkitRequestFullscreen)that.domElement.webkitRequestFullscreen();else if(that.domElement.mozRequestFullScreen)that.domElement.mozRequestFullScreen();else if(that.domElement.msRequestFullscreen)that.domElement.msRequestFullscreen();};that.exitFullscreen=function(){if(!ASJS.DisplayObject.FULLSCREEN_ENABLED)return;if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.msExitFullscreen)document.msExitFullscreen();};that.scale=function(scaleX,scaleY){that.scaleX=scaleX;that.scaleY=scaleY;};that.clear=function(){that.html="";that.text="";};that._sendAddedToStageEvent=function(){var state=that.stage?ASJS.Stage.ADDED_TO_STAGE:ASJS.Stage.REMOVED_FROM_STAGE;if(_state!=CREATED||state!=ASJS.Stage.REMOVED_FROM_STAGE){that.dispatchEvent(state,null,false);};_state=state;};that.getCSS=function(key){return that.domObject.css(key);};that.setCSS=function(key,value){that.domObject.css(key,value);};that.addClass=function(value){return that.domObject.addClass(value);};that.removeClass=function(value){that.domObject.removeClass(value);};that.move=function(x,y){that.x=x;that.y=y;};that.setSize=function(w,h){that.width=w;that.height=h;};that.hitTest=function(point){return ASJS.GeomUtils.hitTest(that,point);};that.localToGlobal=function(point){return ASJS.GeomUtils.localToGlobal(that,point);};that.globalToLocal=function(point){return ASJS.GeomUtils.globalToLocal(that,point);};that.domObject=$(domElement||"<div />",{tabindex:"-1",style:("pointer-events: auto; position: absolute; display: "+_cssDisplay+"; width: 0px; height: 0px; top: 0px; left: 0px;")});function drawTransform(){that.setCSS("transform",'rotate('+_rotation+'deg) scaleX('+_scaleX+') scaleY('+_scaleY+')');};(function(){that.id="intance_"+ASJS.DisplayObject.INSTANCE_ID;ASJS.DisplayObject.INSTANCE_ID++;})();return that;};ASJS.DisplayObject.INSTANCE_ID=0;ASJS.DisplayObject.FULLSCREEN_ENABLED=document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled;ASJS.Sprite=function(domElement){var that=new ASJS.DisplayObject(domElement);var _super={};var _children=[];var _mouseChildren=true;extendProperty(_super,that,"bounds");defineProperty(that,"bounds",{get:function(){var rect=_super.bounds;var size=new ASJS.Rectangle();var i=-1;var l=that.numChildren;while(++i<l){var child=that.getChildAt(i);var childRect=child.bounds;if(i==0){size.x=childRect.x;size.y=childRect.y;size.width=childRect.width+childRect.x;size.height=childRect.height+childRect.y;}else{if(childRect.x<size.x)size.x=childRect.x;if(childRect.y<size.y)size.y=childRect.y;if(childRect.width+childRect.x>size.width)size.width=childRect.width+childRect.x;if(childRect.height+childRect.y>size.height)size.height=childRect.height+childRect.y;}};rect.x+=size.x;rect.y+=size.y;if(size.width-size.x>rect.width)rect.width=size.width-size.x;if(size.height-size.y>rect.height)rect.height=size.height-size.y;return rect;}});extendFunction(_super,that,"_sendAddedToStageEvent");that._sendAddedToStageEvent=function(){_super._sendAddedToStageEvent();var i=-1;var l=that.numChildren;while(++i<l){var child=that.getChildAt(i);child._sendAddedToStageEvent();}};defineProperty(that,"mouseChildren",{get:function(){return _mouseChildren;},set:function(value){_mouseChildren=value;var i=-1;var l=that.numChildren;while(++i<l)that.getChildAt(i).enabled=_mouseChildren;}});defineProperty(that,"numChildren",{get:function(){return _children.length;}});extendFunction(_super,that,"clear");that.clear=function(){while(that.numChildren>0)that.removeChildAt(0);_super.clear();};that.contains=function(child){return that.getChildIndex(child)>-1;};that.addChild=function(child){return that.addChildAt(child,that.numChildren);};that.addChildAt=function(child,index){if(!child)return null;if(child.parent)child.parent.removeChild(child);that.domObject.append(child.domObject);child.enabled=child.enabled?_mouseChildren:child.enabled;_children.push(child);that.setChildIndex(child,index);child.parent=that;return child;};that.removeChild=function(child){if(!child)return null;child.domObject.detach();var index=that.getChildIndex(child);if(index>-1)_children.splice(index,1);child.parent=null;return child;};that.removeChildAt=function(index){return that.removeChild(that.getChildAt(index));};that.getChildAt=function(index){if(index<0||index>that.numChildren-1)return null;return _children[index];};that.setChildIndex=function(child,index){if(!child||index<0)return null;var childActualIndex=that.getChildIndex(child);if(childActualIndex>-1)_children.splice(childActualIndex,1);var afterChild=that.getChildAt(index);if(afterChild)child.domObject.insertBefore(afterChild.domObject);_children.splice(index,0,child);return child;};that.getChildIndex=function(child){if(!child)return-1;return _children.indexOf(child);};that.swapChildren=function(childA,childB){var childAIndex=that.getChildIndex(childA);var childBIndex=that.getChildIndex(childB);if(childAIndex==-1||childBIndex==-1)return false;that.setChildIndex(childA,childBIndex);that.setChildIndex(childB,childAIndex);return true;};that.getChildByDOMObject=function(domObject){if(!domObject)return null;var i=-1;var l=that.numChildren;while(++i<l){var child=that.getChildAt(i);if(domObject.id==child.id)return child;else if(child.numChildren){var grandChild=child.getChildByDOMObject(domObject);if(grandChild)return grandChild;}};return null;};return that;};ASJS.WindowEvent=function(type){var that=new ASJS.Event(type);return that;};ASJS.WindowEvent.POPSTATE="popstate";ASJS.WindowEvent.RESIZE="resize";ASJS.WindowEvent.UNLOAD="unload";ASJS.Stage=function(){function WindowInstance(){var that=new ASJS.DisplayObject();that.domObject=$(window);var _requestAnimationFrame;defineProperty(that,"scrollTop",{get:function(){return that.domObject.scrollTop();},set:function(value){that.domObject.scrollTop(value);}});defineProperty(that,"scrollLeft",{get:function(){return that.domObject.scrollLeft();},set:function(value){that.domObject.scrollLeft(value);}});defineProperty(that,"location",{get:function(){return that.domElement.location;},set:function(value){that.domElement.location=value;}});defineProperty(that,"navigator",{get:function(){return that.domElement.navigator;},set:function(value){that.domElement.navigator=value;}});defineProperty(that,"devicePixelRatio",{get:function(){return that.domElement.devicePixelRatio;}});defineProperty(that,"screen",{get:function(){return that.domElement.screen;}});that.setTimeout=function(callback,duration){return that.domElement.setTimeout(function(){that.requestAnimationFrame(callback);},duration);};that.clearTimeout=function(id){return that.domElement.clearTimeout(id);};that.setInterval=function(callback,duration){return that.domElement.setInterval(function(){that.requestAnimationFrame(callback);},duration);};that.clearInterval=function(id){return that.domElement.clearInterval(id);};that.requestAnimationFrame=function(callback){_requestAnimationFrame(callback);};(function(){_requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(f){return setTimeout(f,1000/60)};})();return that;};function StageInstance(){var that=new ASJS.Sprite();var _inited=false;var _mouse=new ASJS.Mouse().instance;var _window=new WindowInstance();var _head=$("head");that.domObject=$("body");var _stageWidth=0;var _stageHeight=0;defineProperty(that,"title",{get:function(){return document.title;},set:function(value){document.title=value;}});defineProperty(that,"stage",{get:function(){return that;}});defineProperty(that,"stageWidth",{get:function(){return _stageWidth;}});defineProperty(that,"stageHeight",{get:function(){return _stageHeight;}});defineProperty(that,"screenTop",{get:function(){return _window.screen.availTop;}});defineProperty(that,"screenLeft",{get:function(){return _window.screen.availLeft;}});defineProperty(that,"screenWidth",{get:function(){return _window.screen.width;}});defineProperty(that,"screenHeight",{get:function(){return _window.screen.height;}});defineProperty(that,"screenAvailWidth",{get:function(){return _window.screen.availWidth;}});defineProperty(that,"screenAvailHeight",{get:function(){return _window.screen.availHeight;}});defineProperty(that,"window",{get:function(){return _window;}});defineProperty(that,"head",{get:function(){return _head;}});that.init=function(){if(_inited)return;_inited=true;that.clear();that.setSize("100%","100%");that.window.addEventListener(ASJS.WindowEvent.RESIZE,recalcStageSize);recalcStageSize();_mouse.init();};function recalcStageSize(){var overflowX=that.getCSS("overflow-x");var overflowY=that.getCSS("overflow-y");that.setCSS("overflow-x","hidden");that.setCSS("overflow-y","hidden");_stageWidth=that.window.width;_stageHeight=that.window.height;that.setCSS("overflow-x",overflowX);that.setCSS("overflow-y",overflowY);that.dispatchEvent(ASJS.Stage.RESIZE);};return that;};defineProperty(this,"instance",{get:function(){if(!ASJS.Stage.$)ASJS.Stage.$=new StageInstance();return ASJS.Stage.$;}});};ASJS.Stage.RESIZE="ASJS-Stage-resize";ASJS.Stage.ADDED_TO_STAGE="ASJS-Stage-addedToStage";ASJS.Stage.REMOVED_FROM_STAGE="ASJS-Stage-removedFromStage";ASJS.NotificationHandler=function(){function NotificationHandlerInstance(){var that={};var _notificationHandlers={};that.register=function(notificationDispatcher){if(!notificationDispatcher.handlers)return;var i=-1;var l=notificationDispatcher.handlers.length;while(++i<l){var notificationType=notificationDispatcher.handlers[i];if(!_notificationHandlers[notificationType])_notificationHandlers[notificationType]=[];_notificationHandlers[notificationType].push(notificationDispatcher);}};that.remove=function(notificationDispatcher){if(!notificationDispatcher.handlers)return;var i=-1;var l=notificationDispatcher.handlers?notificationDispatcher.handlers.length:0;while(++i<l){var notificationType=notificationDispatcher.handlers[i];if(_notificationHandlers[notificationType]){var index=_notificationHandlers[notificationType].indexOf(notificationDispatcher);if(index>-1)_notificationHandlers[notificationType].splice(index,1);}}};that.sendNotification=function(notificationType,data){var i=-1;var l=_notificationHandlers[notificationType]?_notificationHandlers[notificationType].length:0;var removeHandlers=[];while(++i<l){if(_notificationHandlers[notificationType][i]){_notificationHandlers[notificationType][i].reciveNotification(notificationType,data);}else{_notificationHandlers[notificationType].splice(i,1);l--;}}};return that;};defineProperty(this,"instance",{get:function(){if(!ASJS.NotificationHandler.$)ASJS.NotificationHandler.$=new NotificationHandlerInstance();return ASJS.NotificationHandler.$;}});};ASJS.NotificationDispatcher=function(){var that={};var _notificationHandler=new ASJS.NotificationHandler().instance;that.handlers=[];that.destruct=function(){that.removeNotificationHandlers();that=null;};that.sendNotification=function(notificationType,data){_notificationHandler.sendNotification(notificationType,data);};that.reciveNotification=function(notificationType,data){};that.registerNotificationHandlers=function(){_notificationHandler.register(that);};that.removeNotificationHandlers=function(){_notificationHandler.remove(that);};return that;};ASJS.AbstractCommand=function(){var that=new ASJS.NotificationDispatcher();that.execute=function(){};return that;};function Config(){function ConfigInstance(){var that={};var _data={};defineProperty(that,"data",{get:function(){return _data;},set:function(value){_data=value}});that.get=function(key){return _data&&_data[key]?_data[key]:null;};that.set=function(key,value){_data[key]=value;};that.merge=function(data){merge(_data,data);};function merge(originalData,newData){var newKey;for(newKey in newData){if(typeof originalData[newKey]=="object")merge(originalData[newKey],newData[newKey]);else originalData[newKey]=newData[newKey];}};return that;};defineProperty(this,"instance",{get:function(){if(!Config.$)Config.$=new ConfigInstance();return Config.$;}});};ASJS.LoaderEvent=function(type){var that=new ASJS.Event(type);that.value;return that;};ASJS.LoaderEvent.LOAD="load";ASJS.LoaderEvent.ERROR="error";ASJS.LoaderEvent.ABORT="abort";ASJS.LoaderEvent.LOAD_START="loadstart";ASJS.LoaderEvent.PROGRESS="progress";ASJS.LoaderEvent.LOAD_END="loadend";ASJS.Loader=function(){var that=new ASJS.EventDispatcher();var _url;var _data;var _requestType;var _dataType;var _headers;var _content;defineProperty(that,"url",{get:function(){return _url;}});defineProperty(that,"content",{get:function(){return _content;}});defineProperty(that,"headers",{get:function(){return _headers;},set:function(value){_headers=value;}});defineProperty(that,"data",{get:function(){return _data;},set:function(value){_data=value;}});defineProperty(that,"requestType",{get:function(){return _requestType;},set:function(value){_requestType=value;}});defineProperty(that,"dataType",{get:function(){return _dataType;},set:function(value){_dataType=value;}});that.load=function(url){if(!url)return;_url=url;var requestData={type:_requestType,url:_url,cache:false,contentType:false,crossDomain:true,processData:false,xhrFields:{withCredentials:true,onprogress:onProgress},progress:function(event){if(event.lengthComputable)onProgress(event);},success:onSuccessEvent,error:onErrorEvent,complete:onCompleteEvent};if(_dataType)requestData.dataType=_dataType;if(_data)requestData.data=_data;if(_headers)requestData.headers=_headers;$.ajax(requestData);onLoadStart();};function onSuccessEvent(data){_content=data;onLoad(data);};function onErrorEvent(xhr,textStatus,errorThrown){_content=xhr;onError(xhr);};function onCompleteEvent(data){onLoadEnd(data);};function onLoadStart(){dispatch(ASJS.LoaderEvent.LOAD_START);};function onProgress(data){dispatch(ASJS.LoaderEvent.PROGRESS,data);};function onLoad(data){dispatch(ASJS.LoaderEvent.LOAD,data);};function onLoadEnd(data){dispatch(ASJS.LoaderEvent.LOAD_END,data);};function onError(data){dispatch(ASJS.LoaderEvent.ERROR,data);};function dispatch(type,data){var e=new ASJS.LoaderEvent(type);e.value=data;that.dispatchEvent(e);};return that;};function JSONLoader(){var that=new ASJS.Loader();(function(){that.dataType="json";})();return that;};ASJS.RequestMethod={};ASJS.RequestMethod.DELETE="DELETE";ASJS.RequestMethod.GET="GET";ASJS.RequestMethod.HEAD="HEAD";ASJS.RequestMethod.OPTIONS="OPTIONS";ASJS.RequestMethod.POST="POST";ASJS.RequestMethod.PUT="PUT";ASJS.AnimationDescriptor=function(name,spriteSheet,size,frameDelay,sequenceList){var that={};var _name=name||"";var _spriteSheet=spriteSheet||"";var _size=size||new ASJS.Point();var _frameDelay=Math.floor(Math.max(1,frameDelay||1));var _sequenceList=sequenceList||[];defineProperty(that,"name",{get:function(){return _name;},set:function(value){_name=value;}});defineProperty(that,"sequenceList",{get:function(){return _sequenceList;},set:function(value){_sequenceList=value;}});defineProperty(that,"frameDelay",{get:function(){return _frameDelay;},set:function(value){_frameDelay=value;}});defineProperty(that,"size",{get:function(){return _size;},set:function(value){_size=value;}});defineProperty(that,"spriteSheet",{get:function(){return _spriteSheet;},set:function(value){_spriteSheet=value;}});return that;};ASJS.AnimationLoader=function(){var that={};var _dfd;var _loader;that.load=function(url){_dfd=$.Deferred();_loader=new ASJS.Loader();_loader.requestType=ASJS.RequestMethod.GET;_loader.addEventListener(ASJS.LoaderEvent.LOAD,onLoad);_loader.addEventListener(ASJS.LoaderEvent.ERROR,onLoadError);_loader.dataType="json";_loader.load(url);return _dfd.promise();};function parseAnimationDescriptor(data){var animationDescriptor=new ASJS.AnimationDescriptor(data.id,data.image,new ASJS.Point(data.imageSize.w,data.imageSize.h),data.frameDelay);var i=-1;var l=data.frames.length;var frames=[];while(++i<l){var frame=data.frames[i];var j=-1;var m=Math.max(1,frame.l||1)*animationDescriptor.frameDelay;while(++j<m)frames.push(new ASJS.Rectangle(frame.x,frame.y,frame.w,frame.h));};animationDescriptor.sequenceList=frames;return animationDescriptor;};function onLoad(event){_loader.removeEventListeners();try{var i=-1;var l=_loader.content.length;var animationDescriptorList=[];while(++i<l)animationDescriptorList.push(parseAnimationDescriptor(_loader.content[i]));_dfd.resolve(animationDescriptorList);}catch(e){throw new Error("Invalid animation descriptor file: "+_loader.url);_dfd.reject();}};function onLoadError(event){_loader.removeEventListeners();_dfd.reject();};return that;};function DataProxy(){function DataProxyInstance(){var that={};that.loadJSON=function(url){var dfd=new $.Deferred();var loader=new JSONLoader();loader.requestType=ASJS.RequestMethod.GET;loader.addEventListener(ASJS.LoaderEvent.LOAD,function(e){dfd.resolve(loader.content);});loader.addEventListener(ASJS.LoaderEvent.ERROR,function(e){dfd.reject(loader.content);});loader.load(url);return dfd.promise();};that.loadAnimation=function(url){var animationLoader=new ASJS.AnimationLoader();return animationLoader.load(url);};return that;};defineProperty(this,"instance",{get:function(){if(!DataProxy.$)DataProxy.$=new DataProxyInstance();return DataProxy.$;}});};function ConfigLoaderCommand(){var that=new ASJS.AbstractCommand();var _config=new Config().instance;var _dataProxy=new DataProxy().instance;that.execute=function(){var dfd=_dataProxy.loadJSON("json/config.json");dfd.done(loadComplete);return dfd;};function loadComplete(response){_config.data=response;};return that;};function Language(){function LanguageInstance(){var that={};var _languageItems={};var _supportedLanguages;var _selectedLanguage;defineProperty(that,"data",{get:function(){return _languageItems;},set:function(value){_supportedLanguages=value.supported_languages;_selectedLanguage=value.default_language;_languageItems=value.elements;}});defineProperty(that,"supportedLanguages",{get:function(){return _supportedLanguages;}});defineProperty(that,"selectedLanguage",{set:function(value){_selectedLanguage=value;},get:function(){return _selectedLanguage;}});that.getText=function(key){return _languageItems[key]!=undefined&&_languageItems[key][that.selectedLanguage]!=undefined?_languageItems[key][that.selectedLanguage]:"";};that.genText=function(str){for(var key in _languageItems)str=str.split("{{"+key+"}}").join(that.getText(key));return str;};return that;};defineProperty(this,"instance",{get:function(){if(!Language.$)Language.$=new LanguageInstance();return Language.$;}});};function LanguageLoaderCommand(){var that=new ASJS.AbstractCommand();var _language=new Language().instance;var _dataProxy=new DataProxy().instance;that.execute=function(){var dfd=_dataProxy.loadJSON("json/language.json");dfd.done(loadComplete);return dfd;};function loadComplete(response){_language.data=response;};return that;};function Tools(){function ToolsInstance(){var that={};that.replaceText=function(text,data){for(var key in data)text=text.split("{{"+key+"}}").join(data[key]);return text;};that.isValidEmailAddress=function(email){var re=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return re.test(email);};that.getURLParams=function(param){var url=decodeURIComponent($(location).attr('href')).split("#");if(url[1]==''||url[1]==undefined)return[];var params=url[1].split('&');var i=-1;var l=params.length;var urlParams={};while(++i<l){var line=params[i].split('=');urlParams[line[0]]=line[1];};return urlParams[param];};that.createUrlParams=function(params){var url="";for(var key in params){if(url!="")url+="&";url+=key+"="+params[key];};document.location.href='#'+url;that.reload();};that.reload=function(){stage.window.location.reload(true);};return that;};defineProperty(this,"instance",{get:function(){if(!Tools.$)Tools.$=new ToolsInstance();return Tools.$;}});};function Cookies(){function CookiesInstance(){var that={};that.createCookie=function(name,value,days){if(days){var date=new Date();date.setTime(date.getTime()+(days*86400000));var expires="; expires="+date.toGMTString();}else var expires="";document.cookie=name+"="+value+expires+"; path=/";try{if(typeof(Storage)!=="undefined")localStorage[name]=value;}catch(event){console.log(event);}};that.readCookie=function(name){var nameEQ=name+"=";var ca=document.cookie.split(';');var i=-1;var l=ca.length;while(++i<l){var c=ca[i];while(c.charAt(0)==' ')c=c.substring(1,c.length);if(c.indexOf(nameEQ)==0)return c.substring(nameEQ.length,c.length);};try{if(typeof(Storage)!=="undefined")return localStorage[name];}catch(event){console.log(event);};return null;};that.eraseCookie=function(name){that.createCookie(name,"",-1);try{if(typeof(Storage)!=="undefined")delete localStorage[name];}catch(event){console.log(event);}};return that;};defineProperty(this,"instance",{get:function(){if(!Cookies.$)Cookies.$=new CookiesInstance();return Cookies.$;}});};ASJS.Cycler=function(){function CyclerInstance(){var that={};var _isPlaying=false;var _fps=24;var _interval=getIntervalByFps();var _callbacks=[];var _timeoutId;defineProperty(that,"isPlaying",{get:function(){return _isPlaying;}});defineProperty(that,"fps",{get:function(){return _fps;},set:function(value){_fps=value;_interval=getIntervalByFps();that.start();}});that.addCallback=function(callback){if(that.callbackExists(callback))return;_callbacks.push(callback);};that.removeCallback=function(callback){if(!that.callbackExists(callback))return;var i=-1;var l=_callbacks.length;var index;while(++i<l){if(_callbacks[i]==callback)index=i;};_callbacks.splice(index,1);};that.callbackExists=function(callback){var i=-1;var l=_callbacks.length;while(++i<l){if(_callbacks[i]==callback)return true;};return false;};that.start=function(){_isPlaying=true;tick();};that.stop=function(){_isPlaying=false;_timeoutId=stage.window.clearTimeout(_timeoutId);};function tick(){_timeoutId=stage.window.clearTimeout(_timeoutId);var i=-1;var l=_callbacks.length;while(++i<l){if(_callbacks[i])_callbacks[i]();};_timeoutId=stage.window.setTimeout(tick,_interval);};function getIntervalByFps(){return 1000/_fps;};return that;};defineProperty(this,"instance",{get:function(){if(!ASJS.Cycler.$)ASJS.Cycler.$=new CyclerInstance();return ASJS.Cycler.$;}});};function EnvironmentCommand(){var that=new ASJS.AbstractCommand();var _language=new Language().instance;var _cookies=new Cookies().instance;var _tools=new Tools().instance;var _cycler=new ASJS.Cycler().instance;var _config=new Config().instance;var _sleepToResizeId;that.execute=function(){setupLanguage();setupCycler();setupStage();};function setupLanguage(){var selectedLanguage=_tools.getURLParams('lang');if(selectedLanguage==undefined||_language.supportedLanguages.indexOf(selectedLanguage)==-1)selectedLanguage=_cookies.readCookie('language');if(selectedLanguage==undefined||_language.supportedLanguages.indexOf(selectedLanguage)==-1)selectedLanguage=_language.selectedLanguage;_language.selectedLanguage=selectedLanguage;_cookies.createCookie('language',_language.selectedLanguage);stage.title=_language.getText("title");};function setupCycler(){_cycler.fps=_config.get("fps");_cycler.start();};function setupStage(){stage.addEventListener(ASJS.Stage.RESIZE,onStageResize);};function onStageResize(event){_sleepToResizeId=stage.window.clearTimeout(_sleepToResizeId);_sleepToResizeId=stage.window.setTimeout(onTimeout,_config.get("resizeInterval"));};function onTimeout(){_sleepToResizeId=stage.window.clearTimeout(_sleepToResizeId);that.sendNotification(ASJS.Stage.RESIZE);};return that;};ASJS.AbstractMediator=function(view){var that=new ASJS.NotificationDispatcher();that.view;(function(){that.view=view;})();return that;};ASJS.Easing=function(){var that={};var _cycler=new ASJS.Cycler().instance;var _isPlaying;var _id;var _step;var _target;var _from;var _change;var _to;var _type;var _duration;var _stepCallback;var _completeCallback;that.stop=function(){_isPlaying=false;_cycler.removeCallback(update);};that.play=function(target,to,duration,type,stepCallback,completeCallback){_target=target;_from={};_change={};_to=to;_type=type;_duration=(duration/(1000/_cycler.fps));_stepCallback=stepCallback;_completeCallback=completeCallback;iterateParameters(function(key){_from[key]=_target[key];_change[key]=_to[key]-_from[key];});if(!ASJS.Easing[_type])_type="linearTween";letsPlay();};function letsPlay(){if(_isPlaying)return;_step=0;_isPlaying=true;_cycler.addCallback(update);};function update(){if(!_isPlaying)return;if(_step>=_duration){that.stop();iterateParameters(function(key){_target[key]=_to[key];});if(_stepCallback)_stepCallback();if(_completeCallback)_completeCallback();return;};iterateParameters(function(key){_target[key]=ASJS.Easing[_type](_step,_from[key],_change[key],_duration);});if(_stepCallback)_stepCallback();_step++;};function iterateParameters(callback){var key;for(key in _to){callback(key);}};(function(){that.stop();})();return that;};ASJS.Easing.linearTween=function(t,b,c,d){return c*t/d+b;};ASJS.Easing.easeInQuad=function(t,b,c,d){t/=d;return c*t*t+b;};ASJS.Easing.easeOutQuad=function(t,b,c,d){t/=d;return-c*t*(t-2)+b;};ASJS.Easing.easeInOutQuad=function(t,b,c,d){t/=d/2;if(t<1)return c/2*t*t+b;t--;return-c/2*(t*(t-2)-1)+b;};ASJS.Easing.easeInCubic=function(t,b,c,d){t/=d;return c*t*t*t+b;};ASJS.Easing.easeOutCubic=function(t,b,c,d){t/=d;t--;return c*(t*t*t+1)+b;};ASJS.Easing.easeInOutCubic=function(t,b,c,d){t/=d/2;if(t<1)return c/2*t*t*t+b;t-=2;return c/2*(t*t*t+2)+b;};ASJS.Easing.easeInQuart=function(t,b,c,d){t/=d;return c*t*t*t*t+b;};ASJS.Easing.easeOutQuart=function(t,b,c,d){t/=d;t--;return-c*(t*t*t*t-1)+b;};ASJS.Easing.easeInOutQuart=function(t,b,c,d){t/=d/2;if(t<1)return c/2*t*t*t*t+b;t-=2;return-c/2*(t*t*t*t-2)+b;};ASJS.Easing.easeInQuint=function(t,b,c,d){t/=d;return c*t*t*t*t*t+b;};ASJS.Easing.easeOutQuint=function(t,b,c,d){t/=d;t--;return c*(t*t*t*t*t+1)+b;};ASJS.Easing.easeInOutQuint=function(t,b,c,d){t/=d/2;if(t<1)return c/2*t*t*t*t*t+b;t-=2;return c/2*(t*t*t*t*t+2)+b;};ASJS.Easing.easeInSine=function(t,b,c,d){return-c*Math.cos(t/d*(Math.PI/2))+c+b;};ASJS.Easing.easeOutSine=function(t,b,c,d){return c*Math.sin(t/d*(Math.PI/2))+b;};ASJS.Easing.easeInOutSine=function(t,b,c,d){return-c/2*(Math.cos(Math.PI*t/d)-1)+b;};ASJS.Easing.easeInExpo=function(t,b,c,d){return c*Math.pow(2,10*(t/d-1))+b;};ASJS.Easing.easeOutExpo=function(t,b,c,d){return c*(-Math.pow(2,-10*t/d)+1)+b;};ASJS.Easing.easeInOutExpo=function(t,b,c,d){t/=d/2;if(t<1)return c/2*Math.pow(2,10*(t-1))+b;t--;return c/2*(-Math.pow(2,-10*t)+2)+b;};ASJS.Easing.easeInCirc=function(t,b,c,d){t/=d;return-c*(Math.sqrt(1-t*t)-1)+b;};ASJS.Easing.easeOutCirc=function(t,b,c,d){t/=d;t--;return c*Math.sqrt(1-t*t)+b;};ASJS.Easing.easeInOutCirc=function(t,b,c,d){t/=d/2;if(t<1)return-c/2*(Math.sqrt(1-t*t)-1)+b;t-=2;return c/2*(Math.sqrt(1-t*t)+1)+b;};ASJS.FormElement=function(domElement){var that=new ASJS.Sprite(domElement);defineProperty(that,"tabIndex",{get:function(){return that.getAttr("tabindex");},set:function(value){that.setAttr("tabindex",value);}});defineProperty(that,"name",{get:function(){return that.getAttr("name");},set:function(value){that.setAttr("name",value);}});that.drawNow=function(){};(function(){that.tabIndex="auto";})();return that;};ASJS.Button=function(){var that=new ASJS.FormElement("<input />");defineProperty(that,"label",{get:function(){return that.getAttr("value");},set:function(value){that.setAttr("value",value);}});defineProperty(that,"submit",{get:function(){return that.getAttr("type")=="submit";},set:function(value){that.setAttr("type",value?"submit":"button");}});(function(){that.setAttr("type","button");})();return that;};ASJS.Scale9Grid=function(){var that=new ASJS.Sprite();var _size=new ASJS.Point();var _rectangle=new ASJS.Rectangle();var _blocks=[];var _super={};extendProperty(_super,that,"x");defineProperty(that,"x",{set:function(value){_super.x=value;that.drawNow();}});extendProperty(_super,that,"y");defineProperty(that,"y",{set:function(value){_super.y=value;that.drawNow();}});extendProperty(_super,that,"width");defineProperty(that,"width",{set:function(value){_super.width=value;that.drawNow();}});extendProperty(_super,that,"height");defineProperty(that,"height",{set:function(value){_super.height=value;that.drawNow();}});defineProperty(that,"size",{get:function(){return _size;},set:function(value){_size=value;that.drawNow();}});defineProperty(that,"rect",{get:function(){return _rectangle;},set:function(value){_rectangle=value;that.drawNow();}});extendFunction(_super,that,"setSize");that.setSize=function(w,h){_super.setSize(w,h);that.drawNow();};that.drawNow=function(){var rightSize=_size.x-(_rectangle.x+_rectangle.width);var bottomSize=_size.y-(_rectangle.y+_rectangle.height);var center=new ASJS.Point(that.width-_rectangle.x-rightSize,that.height-_rectangle.y-bottomSize);var percent=new ASJS.Point(Math.round(center.x/_rectangle.width),Math.round(center.y/_rectangle.height));var tl=new ASJS.Point(-(percent.x*_rectangle.x)*2,-(percent.y*_rectangle.y)*2);var br=new ASJS.Point(percent.x*rightSize,percent.y*bottomSize);var ps=new ASJS.Point((_size.x*percent.x)*2,(_size.y*percent.y)*2);_blocks[0].setSize(_rectangle.x,_rectangle.y);_blocks[1].setSize(that.width-_rectangle.x-rightSize,_rectangle.y);_blocks[2].setSize(that.width-_blocks[0].width-_blocks[1].width,_rectangle.y);_blocks[3].setSize(_rectangle.x,that.height-_rectangle.y-bottomSize);_blocks[4].setSize(_blocks[1].width,_blocks[3].height);_blocks[5].setSize(_blocks[2].width,_blocks[3].height);_blocks[6].setSize(_rectangle.x,that.height-_blocks[0].height-_blocks[3].height);_blocks[7].setSize(_blocks[1].width,_blocks[6].height);_blocks[8].setSize(_blocks[2].width,_blocks[6].height);_blocks[1].x=_blocks[0].width;_blocks[2].x=_blocks[1].x+_blocks[1].width;_blocks[3].y=_blocks[0].height;_blocks[4].move(_blocks[3].width,_blocks[1].height);_blocks[5].move(_blocks[4].x+_blocks[4].width,_blocks[1].height);_blocks[6].y=_blocks[3].y+_blocks[3].height;_blocks[7].move(_blocks[6].width,_blocks[6].y);_blocks[8].move(_blocks[7].x+_blocks[7].width,_blocks[6].y);_blocks[1].setCSS("background-position",tl.x+"px top");_blocks[1].setCSS("background-size",ps.x+"px "+_size.y+"px");_blocks[3].setCSS("background-position","left "+tl.y+"px");_blocks[3].setCSS("background-size",_size.x+"px "+ps.y+"px");_blocks[4].setCSS("background-position",tl.x+"px "+tl.y+"px");_blocks[4].setCSS("background-size",ps.x+"px "+ps.y+"px");_blocks[5].setCSS("background-position","right "+tl.y+"px");_blocks[5].setCSS("background-size",_size.x+"px "+ps.y+"px");_blocks[7].setCSS("background-position",tl.x+"px bottom");_blocks[7].setCSS("background-size",ps.x+"px "+_size.y+"px");};defineProperty(that,"backgroundImage",{set:function(value){var i=-1;var l=9;while(++i<l){_blocks[i].setCSS("background-image","url("+value+")");};that.drawNow();}});function init(){var i=-1;var l=9;while(++i<l){_blocks[i]=new ASJS.Sprite();_blocks[i].setCSS("background-repeat","no-repeat");that.addChild(_blocks[i]);};_blocks[0].setCSS("background-position","left top");_blocks[2].setCSS("background-position","right top");_blocks[6].setCSS("background-position","left bottom");_blocks[8].setCSS("background-position","right bottom");};(function(){init();})();return that;};function NotificationView(){var that=new ASJS.Sprite();var _notificationItem={};var _window=new ASJS.Scale9Grid();var _title=new ASJS.Sprite();var _content=new ASJS.Sprite();var _okButton=new ASJS.Button();var _cancelButton=new ASJS.Button();that.hideWindow=function(){_title.html="";_content.html="";if(that.contains(_okButton))that.removeChild(_okButton);_okButton.label="";if(that.contains(_cancelButton))that.removeChild(_cancelButton);_cancelButton.label="";};that.showWindow=function(notificationItem){_notificationItem=notificationItem;_title.html=_notificationItem.title;_content.html=_notificationItem.content;if(_notificationItem['showOk']){_okButton.label=_notificationItem['okLabel'];if(!that.contains(_okButton))that.addChild(_okButton);}else if(that.contains(_okButton))that.removeChild(_okButton);if(_notificationItem['showCancel']){_cancelButton.label=_notificationItem['cancelLabel'];if(!that.contains(_cancelButton))that.addChild(_cancelButton);}else if(that.contains(_cancelButton))that.removeChild(_cancelButton);};that.drawNow=function(){_window.setSize(Math.max(150,Math.min(that.width,_notificationItem.width)),Math.max(150,Math.min(that.height,_notificationItem.height)));_window.move((that.width-_window.width)*0.5,Math.max(0,(that.height-_window.height)*0.5));_title.move(_window.x+25,_window.y+10);_title.width=_window.width-50;_content.move(_title.x,_title.y+_title.height+25);_content.setSize(_title.width,_window.height-_title.height-55-(that.contains(_okButton)||that.contains(_cancelButton)?40:0));if(_content.drawNow)_content.drawNow();_okButton.width=_window.width*0.5-20;if(that.contains(_okButton)){_okButton.x=_window.x+(that.contains(_cancelButton)?_window.width*0.5-10-_okButton.width:((_window.width-_okButton.width)*0.5));_okButton.y=_window.y+_window.height-_okButton.height-30;};_cancelButton.width=_okButton.width;if(that.contains(_cancelButton)){_cancelButton.x=_window.x+(that.contains(_okButton)?_window.width*0.5+10:((_window.width-_cancelButton.width)*0.5));_cancelButton.y=_window.y+_window.height-_cancelButton.height-30;}};function drawButtonStyle(target){target.addClass("notification_button");target.height=42;};(function(){that.setCSS("background-color","rgba( 0, 0, 0, 0.4 )");that.setSize("100%","100%");that.setCSS("position","fixed");_window.size=new ASJS.Point(30,80);_window.rect=new ASJS.Rectangle(13,60,4,7);_window.backgroundImage="images/window.png";that.addChild(_window);_title.height=50;that.addChild(_title);_title.setCSS("line-height",_title.height+"px");_title.addClass("notification_title");_content.addClass("notification_content");that.addChild(_content);_okButton.addEventListener(ASJS.MouseEvent.CLICK,function(event){that.dispatchEvent(NotificationMediator.HIDE);if(_notificationItem['okCallback']!=undefined)_notificationItem['okCallback']();});drawButtonStyle(_okButton);_cancelButton.addEventListener(ASJS.MouseEvent.CLICK,function(event){that.dispatchEvent(NotificationMediator.HIDE);if(_notificationItem['cancelCallback']!=undefined)_notificationItem['cancelCallback']();});drawButtonStyle(_cancelButton);})();return that;};function NotificationDataVo(){var that={};that.title="";that.content="";that.showOk=true;that.showCancel=false;that.okCallback=null;that.cancelCallback=null;that.okLabel=null;that.cancelLabel=null;that.width=500;that.height=200;return that;};function NotificationMediator(view){var that=new ASJS.AbstractMediator(view);var _notificationPool=[];var _showed=false;var _defaultOkLabel="";var _defaultCancelLabel="";var _notificationView=new NotificationView();var _easingTarget={alpha:0};var _easing=new ASJS.Easing();that.handlers=[ASJS.Stage.RESIZE,NotificationMediator.SHOW];that.reciveNotification=function(notificationType,data){switch(notificationType){case ASJS.Stage.RESIZE:onResize();break;case NotificationMediator.SHOW:show(data);break;}};that.setDefault=function(okLabel,cancelLabel){_defaultOkLabel=okLabel;_defaultCancelLabel=cancelLabel;};function onResize(){if(that.view.contains(_notificationView))_notificationView.drawNow();};function show(data){if(data==undefined)data=new NotificationDataVo();if(!data.okLabel)data.okLabel=_defaultOkLabel;if(!data.cancelLabel)data.cancelLabel=_defaultCancelLabel;_notificationPool.push(data);if(!_showed)showWindow();};function hide(){if(_notificationPool.length>0)showWindow();else hideWindow();};function hideWindowAnimationComplete(){_notificationView.hideWindow();that.view.removeChild(_notificationView);_showed=false;};function hideWindow(){animate(1,0,hideWindowAnimationComplete);};function showWindow(){var notificationItem=_notificationPool[0];_notificationPool.shift();_showed=true;_notificationView.showWindow(notificationItem);_notificationView.alpha=0;if(!that.view.contains(_notificationView))that.view.addChild(_notificationView);onResize();animate(0,1);};function animate(from,to,completeCallback){_easingTarget={alpha:from};_easing.stop();_easing.play(_easingTarget,{alpha:to},1000,"easeInOutExpo",function(){_notificationView.alpha=_easingTarget.alpha;},completeCallback);};(function(){_notificationView.addEventListener(NotificationMediator.HIDE,hide);that.registerNotificationHandlers();})();return that;};NotificationMediator.SHOW="NotificationMediator-show";NotificationMediator.HIDE="NotificationMediator-hide";ASJS.Label=function(){var that=new ASJS.DisplayObject("<label />");defineProperty(that,"for",{get:function(){return that.getAttr("for");},set:function(value){if(value&&value.id)that.setAttr("for",value.id);}});return that;};ASJS.Image=function(){var that=new ASJS.DisplayObject("<img />");defineProperty(that,"src",{get:function(){return that.getAttr("src");},set:function(value){that.setAttr("src",value);}});defineProperty(that,"alt",{get:function(){return that.getAttr("alt");},set:function(value){that.setAttr("alt",value);}});defineProperty(that,"imageWidth",{get:function(){return that.domElement.width;}});defineProperty(that,"imageHeight",{get:function(){return that.domElement.height;}});return that;};ASJS.AnimatedSprite=function(){var that=new ASJS.DisplayObject();var _cycler=new ASJS.Cycler().instance;var _animations={};var _isPlaying=false;var _selectedAnimation="";var _step=0;var _angle=ASJS.AnimatedSprite.PLAY_NORMAL;defineProperty(that,"selectedAnimation",{get:function(){return _selectedAnimation;}});that.addAnimationDescriptorList=function(animationDescriptorList){var i=-1;var l=animationDescriptorList.length;while(++i<l)that.addAnimationDescriptor(animationDescriptorList[i]);};that.addAnimationDescriptor=function(animationDescriptor){_animations[animationDescriptor.name]=animationDescriptor;};that.removeAnimationDescriptor=function(name){_animations[name]=null;delete _animations[name];};that.stop=function(){_step=0;_isPlaying=false;_cycler.removeCallback(update);};that.play=function(name,type){if(!_animations[name])return;var angle=!type?ASJS.AnimatedSprite.PLAY_NORMAL:(type==ASJS.AnimatedSprite.PLAY_NORMAL?ASJS.AnimatedSprite.PLAY_NORMAL:ASJS.AnimatedSprite.PLAY_REVERSE);if(_selectedAnimation==name&&_angle==angle){letsPlay();return;};_selectedAnimation=name;_angle=angle;_step=0;var spriteSheet=_animations[_selectedAnimation].spriteSheet;if(spriteSheet!=""){var image=new ASJS.Image();image.addEventListener(ASJS.LoaderEvent.LOAD,function(){that.setCSS("background-image","url("+spriteSheet+")");letsPlay();});image.addEventListener(ASJS.LoaderEvent.ERROR,function(){console.log("Error: missing animation sprite sheet");});image.src=spriteSheet;}else letsPlay();};function letsPlay(){if(_isPlaying)return;_isPlaying=true;_cycler.addCallback(update);};function update(){if(!_isPlaying)return;var selectedAnimation=_animations[_selectedAnimation];var sequenceList=selectedAnimation.sequenceList;var rect=sequenceList[_step];var size=selectedAnimation.size;var percentW=that.width/rect.width;var percentH=that.height/rect.height;that.setCSS("background-position",(-rect.x*percentW)+"px "+(-rect.y*percentH)+"px");that.setCSS("background-size",(size.x*percentW)+"px "+(size.y*percentH)+"px");that.setSize(rect.width*percentW,rect.height*percentH);if(_angle==ASJS.AnimatedSprite.PLAY_NORMAL){_step++;if(_step>=sequenceList.length)_step=0;}else{_step--;if(_step<0)_step=sequenceList.length-1;}};(function(){that.stop();})();return that;};ASJS.AnimatedSprite.PLAY_NORMAL="ASJS-AnimatedSprite-playNormal";ASJS.AnimatedSprite.PLAY_REVERSE="ASJS-AnimatedSprite-playReverse";ASJS.AbstractFilter=function(value){var that={};that.value=value;that.execute=function(){};return that;};ASJS.BlurFilter=function(value){var that=new ASJS.AbstractFilter(value);that.execute=function(){return"blur("+value+"px)";};return that;};function ContentView(){var that=new ASJS.Sprite();var ANIMATION_EXPLODE_ID="animationExplode";var ANIMATION_FIREWORKS_ID="animationFireworks";var _language=new Language().instance;var _mouse=new ASJS.Mouse().instance;var _background=new ASJS.Sprite();var _box=new ASJS.Sprite();var _label=new ASJS.Label();var _button=new ASJS.Button();var _animatedSprite;var _drag=false;that.drawNow=function(){_box.x=(that.width-_box.width)*0.5;};that.init=function(data){_background.addClass("background");_background.setCSS("position","fixed");_background.setSize("100%","100%");_background.alpha=0.5;that.addChild(_background);_box.addClass("box");_box.setSize(320,130);_box.y=100;that.addChild(_box);_label.text=_language.getText("new_asjs_base_site");_label.addClass("box_label");_label.setSize(320,30);_label.move(0,34);_box.addChild(_label);_button.label=_language.getText("show_notification_window");_button.addClass("box_button");_button.setSize(320,40);_button.move(0,_box.height-_button.height);_button.addEventListener(ASJS.MouseEvent.CLICK,onButtonClick);_box.addChild(_button);_animatedSprite=new ASJS.AnimatedSprite();_animatedSprite.addAnimationDescriptorList(data);_animatedSprite.move(10,10);that.addChild(_animatedSprite);_animatedSprite.addEventListener(ASJS.MouseEvent.CLICK,onAnimatedSpriteClick);_animatedSprite.addEventListener(ASJS.MouseEvent.MOUSE_DOWN+" "+ASJS.MouseEvent.TOUCH_START,onAnimatedSpriteMouseDown);stage.addEventListener(ASJS.MouseEvent.MOUSE_UP+" "+ASJS.MouseEvent.TOUCH_END,onDragStop);stage.addEventListener(ASJS.MouseEvent.MOUSE_LEAVE,onDragStop);stage.addEventListener(ASJS.MouseEvent.MOUSE_MOVE+" "+ASJS.MouseEvent.TOUCH_MOVE,onStageMouseMove);that.addEventListener(ASJS.MouseEvent.CLICK,onMouseClick);playFireworksAnimation();that.drawNow();};function addedToStage(){that.removeEventListener(ASJS.Stage.ADDED_TO_STAGE,addedToStage);playFireworksAnimation();};function onButtonClick(event){that.dispatchEvent(ContentMediator.ON_SHOW_NOTIFICATION_WINDOW_CLICK);};function playExplodeAnimation(){if(!_animatedSprite)return;_animatedSprite.setSize(256,128);_animatedSprite.play(ANIMATION_EXPLODE_ID,ASJS.AnimatedSprite.PLAY_REVERSE);};function playFireworksAnimation(){if(!_animatedSprite)return;_animatedSprite.setSize(200,200);_animatedSprite.play(ANIMATION_FIREWORKS_ID);};function onAnimatedSpriteClick(event){if(_animatedSprite.selectedAnimation==ANIMATION_FIREWORKS_ID)playExplodeAnimation();else playFireworksAnimation();};function onAnimatedSpriteMouseDown(event){_drag=true;};function onDragStop(event){_drag=false;};function onStageMouseMove(event){that.filters=[new ASJS.BlurFilter((Math.max(0,that.height/(that.height-_mouse.mouseY))/10))];if(!_drag)return;_animatedSprite.move(_mouse.mouseX-_animatedSprite.width*0.5,_mouse.mouseY-_animatedSprite.height*0.5);};function onMouseClick(event){var hitTest=_box.hitTest(new ASJS.Point(_mouse.mouseX,_mouse.mouseY));_label.text=_language.getText(hitTest?"hit_test_inside":"hit_test_outside");};(function(){that.addEventListener(ASJS.Stage.ADDED_TO_STAGE,addedToStage);})();return that;};function ContentMediator(view){var that=new ASJS.AbstractMediator(view);var _dataProxy=new DataProxy().instance;var _language=new Language().instance;var _contentView=new ContentView();that.handlers=[ASJS.Stage.RESIZE,ContentMediator.SHOW];that.reciveNotification=function(notificationType,data){switch(notificationType){case ASJS.Stage.RESIZE:onResize();break;case ContentMediator.SHOW:onShow();break;}};function onResize(){_contentView.setSize(stage.stageWidth,stage.stageHeight);_contentView.drawNow();};function onLoadAnimation(data){_contentView.init(data);that.view.addChild(_contentView);};function onShow(){_contentView.addEventListener(ContentMediator.ON_SHOW_NOTIFICATION_WINDOW_CLICK,function(){var notificationDataVo=new NotificationDataVo();notificationDataVo.title=_language.getText("notification_title");notificationDataVo.content=_language.getText("notification_content");that.sendNotification(NotificationMediator.SHOW,notificationDataVo);});_dataProxy.loadAnimation("json/animation/contentAnimation.json").done(onLoadAnimation);onResize();};(function(){that.registerNotificationHandlers();})();return that;};ContentMediator.SHOW="ContentMediator-show";ContentMediator.ON_SHOW_NOTIFICATION_WINDOW_CLICK="ContentMediator-onShowNotificationWindowClick";function PreloaderView(){var that=new ASJS.Sprite();(function(){that.setSize("100%","100%");that.setCSS("position","fixed");that.setCSS("background-color","rgba( 0, 0, 0, 0.5 )");})();return that;};function PreloaderMediator(view){var that=new ASJS.AbstractMediator(view);var _counter=0;var _preloaderView=new PreloaderView();var _easingTarget={alpha:0};var _easing=new ASJS.Easing();that.handlers=[PreloaderMediator.SHOW,PreloaderMediator.HIDE];that.reciveNotification=function(notificationType,data){switch(notificationType){case PreloaderMediator.SHOW:onShow();break;case PreloaderMediator.HIDE:onHide();break;}};function onShow(){_counter++;if(_counter==1&&!that.view.contains(_preloaderView)){_preloaderView.alpha=0;that.view.addChild(_preloaderView);animate(0,1);}};function onHideAnimationComplete(){that.view.removeChild(_preloaderView);};function onHide(){_counter--;if(_counter<0)_counter=0;if(_counter==0&&that.view.contains(_preloaderView)){animate(1,0,onHideAnimationComplete);}};function animate(from,to,completeCallback){_easingTarget={alpha:from};_easing.stop();_easing.play(_easingTarget,{alpha:to},1000,"easeInOutExpo",function(){_preloaderView.alpha=_easingTarget.alpha;},completeCallback);};(function(){that.registerNotificationHandlers();})();return that;};PreloaderMediator.SHOW="PreloaderMediator-show";PreloaderMediator.HIDE="PreloaderMediator-hide";function ViewPrepCommand(){var that=new ASJS.AbstractCommand();var _language=new Language().instance;that.execute=function(app){new ContentMediator(app.contentView);new PreloaderMediator(app.preloaderView);var notificationMediator=new NotificationMediator(app.notificationView);notificationMediator.setDefault(_language.getText('notification_ok_button'),_language.getText('notification_cancel_button'));that.sendNotification(ContentMediator.SHOW);};return that;};function StartupCommand(){var that=new ASJS.AbstractCommand();var _app;that.execute=function(app){_app=app;loadConfig();};function loadConfig(){(new ConfigLoaderCommand()).execute().done(loadLanguage);};function loadLanguage(){(new LanguageLoaderCommand()).execute().done(initApplication);};function initApplication(){(new EnvironmentCommand()).execute();(new ViewPrepCommand()).execute(_app);};return that;};function Application(){var that={};var _contentView=new ASJS.Sprite();var _preloaderView=new ASJS.Sprite();var _notificationView=new ASJS.Sprite();defineProperty(that,"contentView",{get:function(){return _contentView;}});defineProperty(that,"preloaderView",{get:function(){return _preloaderView;}});defineProperty(that,"notificationView",{get:function(){return _notificationView;}});(function(){console.log("<AS/JS> Application");stage.addChild(that.contentView);stage.addChild(that.preloaderView);stage.addChild(that.notificationView);(new StartupCommand()).execute(that);})();return that;};ASJS.startASJS(Application);